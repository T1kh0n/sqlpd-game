<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SQL –î–µ—Ç–µ–∫—Ç–∏–≤ - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å SQL</title>
    <meta name="description" content="–ò–∑—É—á–∞–π SQL —á–µ—Ä–µ–∑ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å —Å 200+ —É—Ä–æ–∫–∞–º–∏.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
            width: 100%;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 10px;
            width: 100%;
        }

        .header {
            text-align: center;
            padding: 15px 10px;
            background: rgba(26, 26, 46, 0.9);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .header h1 {
            color: #f39c12;
            font-size: clamp(1.3em, 5vw, 2.5em);
            margin-bottom: 5px;
        }

        .header p {
            color: #95a5a6;
            font-size: clamp(0.8em, 2.5vw, 1.1em);
        }

        .tabs {
            display: flex;
            gap: 5px;
            padding: 8px;
            background: rgba(26, 26, 46, 0.9);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            position: sticky;
            top: 0;
            z-index: 100;
            scrollbar-width: thin;
        }

        .tabs::-webkit-scrollbar {
            height: 4px;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: #f39c12;
            border-radius: 2px;
        }

        .tab-button {
            background: #34495e;
            color: #ecf0f1;
            border: 2px solid #2c3e50;
            padding: 12px 16px;
            cursor: pointer;
            border-radius: 5px;
            font-size: clamp(0.85em, 2.5vw, 1em);
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: fit-content;
        }

        .tab-button.active {
            background: #f39c12;
            color: #1a1a2e;
            border-color: #f39c12;
        }

        .tab-content {
            display: none;
            padding: 10px;
            width: 100%;
            max-width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            width: 100%;
            max-width: 100%;
        }

        @media (min-width: 1024px) {
            .main-layout {
                grid-template-columns: 280px 1fr;
            }
        }

        .sidebar {
            background: #2c3e50;
            padding: 12px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
            width: 100%;
        }

        @media (max-width: 1023px) {
            .sidebar {
                max-height: none;
            }
            
            .sidebar h3 {
                cursor: pointer;
                user-select: none;
                position: relative;
                padding-right: 30px;
            }
            
            .sidebar h3::after {
                content: '‚ñº';
                position: absolute;
                right: 0;
                transition: transform 0.3s;
            }
            
            .sidebar.collapsed h3::after {
                transform: rotate(-90deg);
            }
            
            .sidebar.collapsed .schema-table {
                display: none;
            }
        }

        @media (min-width: 1024px) {
            .sidebar {
                position: sticky;
                top: 70px;
                max-height: calc(100vh - 90px);
            }
        }

        .sidebar h3 {
            color: #3498db;
            margin-bottom: 12px;
            font-size: clamp(0.95em, 2.5vw, 1.1em);
            border-bottom: 2px solid #34495e;
            padding-bottom: 8px;
        }

        .schema-table {
            margin: 8px 0;
            background: #34495e;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .schema-table:active {
            background: #3d5a73;
            transform: scale(0.98);
        }

        @media (hover: hover) {
            .schema-table:hover {
                background: #3d5a73;
            }
        }

        .schema-table h4 {
            color: #2ecc71;
            margin-bottom: 6px;
            font-size: clamp(0.85em, 2.5vw, 0.95em);
        }

        .schema-table ul {
            list-style: none;
            padding-left: 12px;
        }

        .schema-table li {
            color: #95a5a6;
            padding: 5px 0;
            cursor: pointer;
            font-size: clamp(0.8em, 2.5vw, 0.9em);
            touch-action: manipulation;
        }

        .schema-table li:active {
            color: #3498db;
        }

        @media (hover: hover) {
            .schema-table li:hover {
                color: #3498db;
            }
        }

        .main-content {
            background: #2c3e50;
            padding: 15px;
            border-radius: 10px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .mission-brief {
            background: #34495e;
            padding: 12px;
            border-left: 4px solid #e74c3c;
            margin-bottom: 12px;
            border-radius: 5px;
        }

        .mission-brief h2 {
            color: #e74c3c;
            margin-bottom: 8px;
            font-size: clamp(1.1em, 4vw, 1.5em);
        }

        .mission-brief p {
            line-height: 1.5;
            margin-bottom: 6px;
            font-size: clamp(0.85em, 2.5vw, 1em);
            word-wrap: break-word;
        }

        .pack-badge {
            display: inline-block;
            background: #f39c12;
            color: #1a1a2e;
            padding: 4px 10px;
            border-radius: 3px;
            font-size: clamp(0.75em, 2vw, 0.8em);
            font-weight: bold;
            margin-bottom: 8px;
        }

        .sql-editor {
            background: #1a1a2e;
            padding: 12px;
            border-radius: 5px;
            margin: 12px 0;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #3498db;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: clamp(0.9em, 2.5vw, 1.1em);
            flex-wrap: wrap;
            gap: 8px;
        }

        .format-btn {
            background: #34495e;
            color: #ecf0f1;
            border: 1px solid #2c3e50;
            padding: 8px 14px;
            cursor: pointer;
            border-radius: 3px;
            font-size: clamp(0.8em, 2.5vw, 0.85em);
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .format-btn:active {
            background: #f39c12;
            color: #1a1a2e;
        }

        @media (hover: hover) {
            .format-btn:hover {
                background: #f39c12;
                color: #1a1a2e;
            }
        }

        .keywords-slider {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            scrollbar-width: thin;
            width: 100%;
            max-width: 100%;
        }

        .keywords-slider::-webkit-scrollbar {
            height: 6px;
        }

        .keywords-slider::-webkit-scrollbar-thumb {
            background: #f39c12;
            border-radius: 3px;
        }

        .keyword-btn {
            background: #34495e;
            color: #ecf0f1;
            border: 1px solid #2c3e50;
            padding: 10px 14px;
            cursor: pointer;
            border-radius: 5px;
            font-size: clamp(0.8em, 2.5vw, 0.85em);
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
            touch-action: manipulation;
        }

        .keyword-btn:active {
            background: #3498db;
            color: white;
            transform: scale(0.95);
        }

        @media (hover: hover) {
            .keyword-btn:hover {
                background: #3498db;
                color: white;
                transform: scale(1.05);
            }
        }

        .sql-input {
            width: 100%;
            max-width: 100%;
            background: #0d0d1b;
            color: #2ecc71;
            border: 2px solid #34495e;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: clamp(0.9em, 2.8vw, 1.1em);
            border-radius: 5px;
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
            box-sizing: border-box;
        }

        .sql-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 10px;
            width: 100%;
        }

        @media (max-width: 480px) {
            .button-group {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            padding: 14px 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: clamp(0.9em, 2.5vw, 1em);
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
            font-weight: bold;
            text-align: center;
            touch-action: manipulation;
            width: 100%;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: #2ecc71;
            color: #1a1a2e;
        }

        .btn-primary:active {
            background: #27ae60;
        }

        .btn-secondary {
            background: #3498db;
            color: white;
        }

        .btn-secondary:active {
            background: #2980b9;
        }

        .btn-clear {
            background: #e74c3c;
            color: white;
        }

        .btn-clear:active {
            background: #c0392b;
        }

        .result-area {
            background: #1a1a2e;
            padding: 12px;
            border-radius: 5px;
            margin-top: 12px;
            min-height: 80px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .result-area h3 {
            color: #f39c12;
            margin-bottom: 10px;
            font-size: clamp(1em, 3vw, 1.2em);
        }

        .result-table {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .result-table table {
            width: 100%;
            border-collapse: collapse;
            min-width: 300px;
        }

        .result-table th {
            background: #34495e;
            color: #f39c12;
            padding: 10px 8px;
            text-align: left;
            border: 1px solid #1a1a2e;
            font-size: clamp(0.8em, 2.5vw, 0.9em);
        }

        .result-table td {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px 8px;
            border: 1px solid #1a1a2e;
            font-size: clamp(0.75em, 2.5vw, 0.85em);
            word-break: break-word;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 12px;
            border-left: 4px solid #2ecc71;
        }

        .success h3 {
            font-size: clamp(1em, 3vw, 1.2em);
            margin-bottom: 8px;
        }

        .error {
            background: #c0392b;
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin-top: 12px;
            font-size: clamp(0.85em, 2.5vw, 1em);
            word-wrap: break-word;
        }

        .hint {
            background: #34495e;
            padding: 12px;
            border-radius: 5px;
            margin-top: 12px;
            border-left: 4px solid #3498db;
            font-size: clamp(0.85em, 2.5vw, 1em);
            word-wrap: break-word;
        }

        .hint code {
            display: block;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .level-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            overflow-x: auto;
            padding: 5px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .level-selector::-webkit-scrollbar {
            height: 6px;
        }

        .level-selector::-webkit-scrollbar-thumb {
            background: #f39c12;
            border-radius: 3px;
        }

        .level-btn {
            background: #34495e;
            color: #ecf0f1;
            border: 2px solid #2c3e50;
            padding: 10px 14px;
            cursor: pointer;
            border-radius: 5px;
            font-size: clamp(0.8em, 2.5vw, 0.95em);
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .level-btn.active {
            background: #2ecc71;
            color: #1a1a2e;
            border-color: #2ecc71;
        }

        .level-btn.completed {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .level-btn:active {
            transform: scale(0.95);
        }

        .progress-bar {
            background: #34495e;
            height: 30px;
            border-radius: 15px;
            margin: 12px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: clamp(0.85em, 2.5vw, 1em);
        }

        .insert-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: #1a1a2e;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-size: clamp(0.85em, 2.5vw, 1em);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
            max-width: calc(100vw - 40px);
        }

        .insert-indicator.show {
            opacity: 1;
        }

        .settings-section {
            background: #34495e;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .settings-section h3 {
            color: #f39c12;
            margin-bottom: 12px;
            font-size: clamp(1em, 3vw, 1.2em);
        }

        .next-mission-btn {
            background: #f39c12;
            color: #1a1a2e;
            margin-top: 10px;
        }

        .info-box {
            background: #34495e;
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }

        .info-box p {
            color: #ecf0f1;
            line-height: 1.5;
            margin: 5px 0;
            font-size: clamp(0.85em, 2.5vw, 1em);
        }

        .info-box h3, .info-box h4 {
            font-size: clamp(0.95em, 3vw, 1.1em);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .stat-card {
            background: #34495e;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #f39c12;
        }

        .stat-card h4 {
            color: #3498db;
            font-size: clamp(0.8em, 2.5vw, 0.9em);
            margin-bottom: 8px;
        }

        .stat-card .value {
            color: #2ecc71;
            font-size: clamp(1.5em, 5vw, 2em);
            font-weight: bold;
        }

        .footer {
            text-align: center;
            padding: 15px;
            color: #95a5a6;
            margin-top: 20px;
            border-top: 1px solid #34495e;
            font-size: clamp(0.8em, 2.5vw, 0.9em);
        }

        .footer a {
            color: #3498db;
            text-decoration: none;
        }

        .footer a:active {
            text-decoration: underline;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
        }

        button, .keyword-btn, .level-btn, .tab-button {
            min-height: 44px;
            min-width: 44px;
        }

        /* JSON Import Tool */
        .import-tool {
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #3498db;
        }

        .import-tool textarea {
            width: 100%;
            min-height: 200px;
            background: #1a1a2e;
            color: #2ecc71;
            border: 2px solid #2c3e50;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            border-radius: 5px;
            resize: vertical;
        }

        .import-tool textarea:focus {
            outline: none;
            border-color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç SQL –î–µ—Ç–µ–∫—Ç–∏–≤</h1>
            <p>–ò–∑—É—á–∞–π SQL —á–µ—Ä–µ–∑ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('missions')">üéØ –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</button>
            <button class="tab-button" onclick="switchTab('guide')">üìñ –°–ø—Ä–∞–≤–∫–∞</button>
            <button class="tab-button" onclick="switchTab('import')">üì• –ò–º–ø–æ—Ä—Ç</button>
            <button class="tab-button" onclick="switchTab('progress')">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</button>
            <button class="tab-button" onclick="switchTab('about')">‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</button>
        </div>

        <!-- Missions Tab -->
        <div id="missions" class="tab-content active">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>

            <div class="level-selector" id="levelSelector"></div>

            <div class="main-layout">
                <aside class="sidebar" id="schemaSidebar">
                    <h3 onclick="toggleSidebar()">üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <div id="sidebarSchema"></div>
                </aside>

                <div class="main-content">
                    <div id="missionContent"></div>

                    <div class="sql-editor">
                        <div class="editor-header">
                            <span>üíª SQL –†–µ–¥–∞–∫—Ç–æ—Ä</span>
                            <button class="format-btn" onclick="formatSQL()">‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        
                        <div class="keywords-slider">
                            <button class="keyword-btn" onclick="insertKeyword('SELECT ')">SELECT</button>
                            <button class="keyword-btn" onclick="insertKeyword('FROM ')">FROM</button>
                            <button class="keyword-btn" onclick="insertKeyword('WHERE ')">WHERE</button>
                            <button class="keyword-btn" onclick="insertKeyword('AND ')">AND</button>
                            <button class="keyword-btn" onclick="insertKeyword('OR ')">OR</button>
                            <button class="keyword-btn" onclick="insertKeyword('COUNT(*)')">COUNT</button>
                            <button class="keyword-btn" onclick="insertKeyword('SUM()')">SUM</button>
                            <button class="keyword-btn" onclick="insertKeyword('AVG()')">AVG</button>
                            <button class="keyword-btn" onclick="insertKeyword('MAX()')">MAX</button>
                            <button class="keyword-btn" onclick="insertKeyword('MIN()')">MIN</button>
                            <button class="keyword-btn" onclick="insertKeyword('GROUP BY ')">GROUP BY</button>
                            <button class="keyword-btn" onclick="insertKeyword('ORDER BY ')">ORDER BY</button>
                            <button class="keyword-btn" onclick="insertKeyword('HAVING ')">HAVING</button>
                            <button class="keyword-btn" onclick="insertKeyword('LIMIT ')">LIMIT</button>
                            <button class="keyword-btn" onclick="insertKeyword('DISTINCT ')">DISTINCT</button>
                            <button class="keyword-btn" onclick="insertKeyword('INNER JOIN ')">JOIN</button>
                            <button class="keyword-btn" onclick="insertKeyword('ON ')">ON</button>
                            <button class="keyword-btn" onclick="insertKeyword('LIKE ')">LIKE</button>
                            <button class="keyword-btn" onclick="insertKeyword('IN ')">IN</button>
                            <button class="keyword-btn" onclick="insertKeyword('BETWEEN ')">BETWEEN</button>
                            <button class="keyword-btn" onclick="insertKeyword(' = ')">=</button>
                            <button class="keyword-btn" onclick="insertKeyword(' > ')">></button>
                            <button class="keyword-btn" onclick="insertKeyword(' < ')"><</button>
                            <button class="keyword-btn" onclick="insertKeyword('*')">*</button>
                            <button class="keyword-btn" onclick="insertKeyword(', ')">,</button>
                        </div>

                        <textarea id="sqlInput" class="sql-input" placeholder="–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å..."></textarea>
                        
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="executeQuery()">üîç –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                            <button class="btn btn-secondary" onclick="showHint()">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                            <button class="btn btn-clear" onclick="clearQuery()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>

                    <div class="result-area">
                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
                        <div id="resultContent">
                            <p style="color: #95a5a6;">–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–ø–æ–ª–Ω–∏—Ç—å"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guide Tab -->
        <div id="guide" class="tab-content">
            <div class="main-content">
                <h2 style="color: #f39c12; margin-bottom: 15px;">üìñ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ SQL</h2>
                
                <div style="margin-bottom: 20px;">
                    <h3 style="color: #3498db; margin: 15px 0 10px;">SELECT - –í—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞;
SELECT —Å—Ç–æ–ª–±–µ—Ü1, —Å—Ç–æ–ª–±–µ—Ü2 FROM —Ç–∞–±–ª–∏—Ü–∞;</pre>
                    
                    <h3 style="color: #3498db; margin: 15px 0 10px;">WHERE - –£—Å–ª–æ–≤–∏—è</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –≤–æ–∑—Ä–∞—Å—Ç > 30;
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –≥–æ—Ä–æ–¥ = '–ú–æ—Å–∫–≤–∞';</pre>
                    
                    <h3 style="color: #3498db; margin: 15px 0 10px;">LIKE - –ü–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω—É</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –∏–º—è LIKE '–ê%';
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –∏–º—è LIKE '%–æ–≤';
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –∏–º—è LIKE '%–∞–Ω%';</pre>

                    <h3 style="color: #3498db; margin: 15px 0 10px;">IN –∏ BETWEEN</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –≥–æ—Ä–æ–¥ IN ('–ú–æ—Å–∫–≤–∞', '–ö–∞–∑–∞–Ω—å');
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ WHERE –≤–æ–∑—Ä–∞—Å—Ç BETWEEN 25 AND 40;</pre>
                    
                    <h3 style="color: #3498db; margin: 15px 0 10px;">ORDER BY - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ ORDER BY –≤–æ–∑—Ä–∞—Å—Ç DESC;
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ ORDER BY –∏–º—è ASC;</pre>
                    
                    <h3 style="color: #3498db; margin: 15px 0 10px;">–ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT COUNT(*) FROM —Ç–∞–±–ª–∏—Ü–∞;
SELECT AVG(–≤–æ–∑—Ä–∞—Å—Ç) FROM —Ç–∞–±–ª–∏—Ü–∞;
SELECT SUM(—É—â–µ—Ä–±) FROM —Ç–∞–±–ª–∏—Ü–∞;
SELECT MIN(–≤–æ–∑—Ä–∞—Å—Ç), MAX(–≤–æ–∑—Ä–∞—Å—Ç) FROM —Ç–∞–±–ª–∏—Ü–∞;</pre>

                    <h3 style="color: #3498db; margin: 15px 0 10px;">GROUP BY - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT –≥–æ—Ä–æ–¥, COUNT(*) FROM —Ç–∞–±–ª–∏—Ü–∞ GROUP BY –≥–æ—Ä–æ–¥;</pre>

                    <h3 style="color: #3498db; margin: 15px 0 10px;">HAVING - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT –≥–æ—Ä–æ–¥, COUNT(*) AS –∫–æ–ª FROM —Ç–∞–±–ª–∏—Ü–∞ 
GROUP BY –≥–æ—Ä–æ–¥ 
HAVING COUNT(*) > 2;</pre>

                    <h3 style="color: #3498db; margin: 15px 0 10px;">DISTINCT - –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT DISTINCT –≥–æ—Ä–æ–¥ FROM —Ç–∞–±–ª–∏—Ü–∞;</pre>

                    <h3 style="color: #3498db; margin: 15px 0 10px;">LIMIT - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ LIMIT 5;
SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞ LIMIT 5 OFFSET 10;</pre>
                    
                    <h3 style="color: #3498db; margin: 15px 0 10px;">JOIN - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</h3>
                    <pre style="background: #1a1a2e; padding: 12px; border-radius: 5px; color: #2ecc71; overflow-x: auto;">SELECT * FROM —Ç–∞–±–ª–∏—Ü–∞1 
INNER JOIN —Ç–∞–±–ª–∏—Ü–∞2 ON —Ç–∞–±–ª–∏—Ü–∞1.id = —Ç–∞–±–ª–∏—Ü–∞2.id;</pre>
                </div>
            </div>
        </div>

        <!-- Import Tab -->
        <div id="import" class="tab-content">
            <div class="main-content">
                <h2 style="color: #f39c12; margin-bottom: 15px;">üì• –ò–º–ø–æ—Ä—Ç –∏ –≠–∫—Å–ø–æ—Ä—Ç</h2>
                
                <div class="import-tool">
                    <h3 style="color: #f39c12; margin-bottom: 10px;">üîß –í—Å—Ç–∞–≤–∏—Ç—å JSON —Å —É—Ä–æ–∫–∞–º–∏</h3>
                    <p style="color: #95a5a6; margin-bottom: 15px; font-size: 0.9em;">
                        –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –º–∞—Å—Å–∏–≤ "packs" –∏–∑ –≤–∞—à–µ–≥–æ JSON —Ñ–∞–π–ª–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å"
                    </p>
                    <textarea id="jsonInput" placeholder='–í—Å—Ç–∞–≤—å—Ç–µ JSON, –Ω–∞–ø—Ä–∏–º–µ—Ä: [{"packName": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã", ...}]'></textarea>
                    <button class="btn btn-primary" onclick="applyJsonLevels()" style="margin-top: 10px;">
                        ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —É—Ä–æ–∫–∏
                    </button>
                    <div id="jsonStatus" style="margin-top: 10px;"></div>
                </div>

                <div class="settings-section">
                    <h3>–ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞</h3>
                    <p style="color: #95a5a6; margin-bottom: 15px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–º—ã –∏–∑ JSON —Ñ–∞–π–ª–∞</p>
                    
                    <button class="btn btn-primary" onclick="importPacks()" style="width: 100%;">
                        üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—ã –∏–∑ —Ñ–∞–π–ª–∞
                    </button>
                </div>

                <div class="settings-section">
                    <h3>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                    <p style="color: #95a5a6; margin-bottom: 15px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                    
                    <button class="btn btn-secondary" onclick="exportAllPacks()" style="width: 100%; margin-bottom: 10px;">
                        üíæ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–µ–º—ã
                    </button>
                    
                    <button class="btn btn-secondary" onclick="exportProgress()" style="width: 100%;">
                        üìä –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                    </button>
                </div>

                <div class="settings-section">
                    <h3>–°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö</h3>
                    <button class="btn btn-clear" onclick="resetProgress()" style="width: 100%;">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                </div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <div class="main-content">
                <h2 style="color: #f39c12; margin-bottom: 15px;">üìà –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
                <div id="progressDetails"></div>
            </div>
        </div>

        <!-- About Tab -->
        <div id="about" class="tab-content">
            <div class="main-content">
                <h2 style="color: #f39c12; margin-bottom: 15px;">‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ SQL –î–µ—Ç–µ–∫—Ç–∏–≤</h2>
                
                <div class="info-box">
                    <p><strong>SQL –î–µ—Ç–µ–∫—Ç–∏–≤</strong> - —ç—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è SQL —á–µ—Ä–µ–∑ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.</p>
                </div>

                <div class="info-box">
                    <h3 style="color: #3498db; margin-bottom: 10px;">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h3>
                    <p>‚úÖ 50+ –≥–æ—Ç–æ–≤—ã—Ö —É—Ä–æ–∫–æ–≤ –ø–æ SQL</p>
                    <p>‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä</p>
                    <p>‚úÖ –î–µ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ —Å—é–∂–µ—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏</p>
                    <p>‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                    <p>‚úÖ –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç —Ç–µ–º</p>
                    <p>‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
                </div>

                <div class="info-box">
                    <h3 style="color: #3498db; margin-bottom: 10px;">–¢–µ–º—ã –∫—É—Ä—Å–∞:</h3>
                    <p>üìù SELECT - –æ—Å–Ω–æ–≤—ã –≤—ã–±–æ—Ä–∫–∏</p>
                    <p>üîç WHERE - —É—Å–ª–æ–≤–∏—è –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è</p>
                    <p>üéØ LIKE - –ø–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω–∞–º</p>
                    <p>üìä –ê–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (COUNT, SUM, AVG, MIN, MAX)</p>
                    <p>üóÇÔ∏è GROUP BY –∏ HAVING</p>
                    <p>‚ö° DISTINCT –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</p>
                    <p>üìÑ LIMIT –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è</p>
                    <p>üîó JOIN - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü</p>
                    <p>... –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!</p>
                </div>

                <div class="info-box">
                    <h3 style="color: #3498db; margin-bottom: 10px;">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</h3>
                    <p>HTML5, CSS3, JavaScript (Vanilla)</p>
                    <p>LocalStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
                    <p>–ë–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>SQL –î–µ—Ç–µ–∫—Ç–∏–≤ ¬© 2025 | –°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è SQL</p>
        </div>
    </div>

    <div class="insert-indicator" id="insertIndicator">‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ</div>

    <script>
// ============================================
// –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–´–ï –¢–ï–ú–´ - –ê–í–¢–û–ó–ê–ì–†–£–ó–ö–ê
// ============================================
// –í—Å—Ç–∞–≤—å—Ç–µ –º–∞—Å—Å–∏–≤ "packs" –∏–∑ –≤–∞—à–µ–≥–æ JSON –∑–¥–µ—Å—å ‚Üì
const GENERATED_PACKS = [
    // –ú–ê–°–°–ò–í –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –ó–ê–ü–û–õ–ù–ò–¢–°–Ø –ü–û–°–õ–ï –í–°–¢–ê–í–ö–ò JSON –í –ò–ú–ü–û–†–¢
];

// ============================================
// –ë–ê–ó–û–í–´–ô –ù–ê–ë–û–† –£–†–û–ö–û–í
// ============================================

const DEFAULT_LEVEL_PACK = {
    packName: "–ë–∞–∑–æ–≤—ã–π –∫—É—Ä—Å SQL",
    packDescription: "–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ SQL –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –¥–µ—Ç–µ–∫—Ç–∏–≤–æ–≤",
    author: "SQL Detective Team",
    version: "1.0",
    database: {
        –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ: [
            {id: 1, –∏–º—è: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', –≤–æ–∑—Ä–∞—Å—Ç: 35, –≥–æ—Ä–æ–¥: '–ú–æ—Å–∫–≤–∞', –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç', –∞–ª–∏–±–∏: '–î–æ–º–∞'},
            {id: 2, –∏–º—è: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', –≤–æ–∑—Ä–∞—Å—Ç: 28, –≥–æ—Ä–æ–¥: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: '–í—Ä–∞—á', –∞–ª–∏–±–∏: '–ù–∞ —Ä–∞–±–æ—Ç–µ'},
            {id: 3, –∏–º—è: '–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤', –≤–æ–∑—Ä–∞—Å—Ç: 42, –≥–æ—Ä–æ–¥: '–ú–æ—Å–∫–≤–∞', –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: '–ë–∏–∑–Ω–µ—Å–º–µ–Ω', –∞–ª–∏–±–∏: '–ù–µ—Ç'},
            {id: 4, –∏–º—è: '–û–ª—å–≥–∞ –ö—É–∑–Ω–µ—Ü–æ–≤–∞', –≤–æ–∑—Ä–∞—Å—Ç: 31, –≥–æ—Ä–æ–¥: '–ö–∞–∑–∞–Ω—å', –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: '–£—á–∏—Ç–µ–ª—å', –∞–ª–∏–±–∏: '–í —à–∫–æ–ª–µ'},
            {id: 5, –∏–º—è: '–î–º–∏—Ç—Ä–∏–π –í–æ–ª–∫–æ–≤', –≤–æ–∑—Ä–∞—Å—Ç: 45, –≥–æ—Ä–æ–¥: '–ú–æ—Å–∫–≤–∞', –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: '–í–æ–¥–∏—Ç–µ–ª—å', –∞–ª–∏–±–∏: '–ù–µ—Ç'}
        ],
        –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è: [
            {id: 1, —Ç–∏–ø: '–ö—Ä–∞–∂–∞', –¥–∞—Ç–∞: '2025-12-10', —Ä–∞–π–æ–Ω: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', —É—â–µ—Ä–±: 50000, —Å—Ç–∞—Ç—É—Å: '–†–∞—Å—Å–ª–µ–¥—É–µ—Ç—Å—è'},
            {id: 2, —Ç–∏–ø: '–í–∑–ª–æ–º', –¥–∞—Ç–∞: '2025-12-12', —Ä–∞–π–æ–Ω: '–°–µ–≤–µ—Ä–Ω—ã–π', —É—â–µ—Ä–±: 120000, —Å—Ç–∞—Ç—É—Å: '–†–∞—Å—Å–ª–µ–¥—É–µ—Ç—Å—è'},
            {id: 3, —Ç–∏–ø: '–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ', –¥–∞—Ç–∞: '2025-12-15', —Ä–∞–π–æ–Ω: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π', —É—â–µ—Ä–±: 75000, —Å—Ç–∞—Ç—É—Å: '–ó–∞–∫—Ä—ã—Ç–æ'}
        ],
        —É–ª–∏–∫–∏: [
            {id: 1, —Ç–∏–ø: '–û—Ç–ø–µ—á–∞—Ç–∫–∏', –æ–ø–∏—Å–∞–Ω–∏–µ: '–ù–∞ –æ–∫–Ω–µ', –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ_id: 1},
            {id: 2, —Ç–∏–ø: '–í–∏–¥–µ–æ–∑–∞–ø–∏—Å—å', –æ–ø–∏—Å–∞–Ω–∏–µ: '–° –∫–∞–º–µ—Ä—ã', –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ_id: 2},
            {id: 3, —Ç–∏–ø: '–î–æ–∫—É–º–µ–Ω—Ç—ã', –æ–ø–∏—Å–∞–Ω–∏–µ: '–ü–æ–¥–¥–µ–ª—å–Ω—ã–µ', –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ_id: 3}
        ]
    },
    missions: [
        {
            title: '–î–µ–ª–æ #1: –ü–µ—Ä–≤–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
            description: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ—Ç–¥–µ–ª! –í–∞–º –Ω—É–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –±–∞–∑—É –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö. –≠—Ç–æ –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ.',
            task: '–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ—Ö –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.',
            hint: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: SELECT * FROM –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ',
            schema: { –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ: ['id', '–∏–º—è', '–≤–æ–∑—Ä–∞—Å—Ç', '–≥–æ—Ä–æ–¥', '–ø—Ä–æ—Ñ–µ—Å—Å–∏—è', '–∞–ª–∏–±–∏'] },
            solution: 'SELECT * FROM –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ',
            checkFunction: 'result.length === 5 && query.toLowerCase().includes("select") && query.toLowerCase().includes("–ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ")'
        },
        {
            title: '–î–µ–ª–æ #2: –ü–æ–∏—Å–∫ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É',
            description: '–ü–æ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å–∫–∏–º –ø–æ–∫–∞–∑–∞–Ω–∏—è–º, –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫ —Å—Ç–∞—Ä—à–µ 40 –ª–µ—Ç. –ù–∞–π–¥–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö.',
            task: '–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ—Ö –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö —Å—Ç–∞—Ä—à–µ 40 –ª–µ—Ç.',
            hint: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WHERE –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: WHERE –≤–æ–∑—Ä–∞—Å—Ç > 40',
            schema: { –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ: ['id', '–∏–º—è', '–≤–æ–∑—Ä–∞—Å—Ç', '–≥–æ—Ä–æ–¥'] },
            solution: 'SELECT * FROM –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ WHERE –≤–æ–∑—Ä–∞—Å—Ç > 40',
            checkFunction: 'result.length === 2 && query.toLowerCase().includes("where")'
        },
        {
            title: '–î–µ–ª–æ #3: –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π',
            description: '–í—Å–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –ú–æ—Å–∫–≤–µ. –ù–∞–π–¥–∏—Ç–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö –∏–∑ —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞.',
            task: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö, –ø—Ä–æ–∂–∏–≤–∞—é—â–∏—Ö –≤ –ú–æ—Å–∫–≤–µ.',
            hint: 'WHERE –≥–æ—Ä–æ–¥ = \'–ú–æ—Å–∫–≤–∞\'',
            schema: { –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ: ['id', '–∏–º—è', '–≥–æ—Ä–æ–¥', '–∞–ª–∏–±–∏'] },
            solution: 'SELECT * FROM –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ WHERE –≥–æ—Ä–æ–¥ = \'–ú–æ—Å–∫–≤–∞\'',
            checkFunction: 'result.length === 3 && query.toLowerCase().includes("–º–æ—Å–∫–≤–∞")'
        },
        {
            title: '–î–µ–ª–æ #4: –ü–æ–¥—Å—á—ë—Ç –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π',
            description: '–ù–∞—á–∞–ª—å—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç—á—ë—Ç –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π.',
            task: '–ü–æ–¥—Å—á–∏—Ç–∞–π—Ç–µ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π –≤ –±–∞–∑–µ.',
            hint: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ COUNT(*): SELECT COUNT(*) FROM –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è',
            schema: { –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è: ['id', '—Ç–∏–ø', '–¥–∞—Ç–∞', '—Ä–∞–π–æ–Ω'] },
            solution: 'SELECT COUNT(*) FROM –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è',
            checkFunction: 'result[0] && Object.values(result[0])[0] === 3 && query.toLowerCase().includes("count")'
        },
        {
            title: '–î–µ–ª–æ #5: –ë–µ–∑ –∞–ª–∏–±–∏',
            description: '–°–∞–º—ã–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ - —Ç–µ, —É –∫–æ–≥–æ –Ω–µ—Ç –∞–ª–∏–±–∏.',
            task: '–ù–∞–π–¥–∏—Ç–µ –≤—Å–µ—Ö –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã—Ö –±–µ–∑ –∞–ª–∏–±–∏ (–∞–ª–∏–±–∏ = "–ù–µ—Ç").',
            hint: 'WHERE –∞–ª–∏–±–∏ = \'–ù–µ—Ç\'',
            schema: { –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ: ['id', '–∏–º—è', '–∞–ª–∏–±–∏', '–ø—Ä–æ—Ñ–µ—Å—Å–∏—è'] },
            solution: 'SELECT * FROM –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ–º—ã–µ WHERE –∞–ª–∏–±–∏ = \'–ù–µ—Ç\'',
            checkFunction: 'result.length === 2 && query.toLowerCase().includes("where")'
        }
    ]
};

// ============================================
// –§–£–ù–ö–¶–ò–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø JSON
// ============================================

function applyJsonLevels() {
    const jsonInput = document.getElementById('jsonInput');
    const statusDiv = document.getElementById('jsonStatus');
    
    try {
        const packs = JSON.parse(jsonInput.value);
        
        if (!Array.isArray(packs)) {
            throw new Error('JSON –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º –ø–∞–∫–µ—Ç–æ–≤');
        }
        
        // –û—á–∏—â–∞–µ–º GENERATED_PACKS –∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
        GENERATED_PACKS.length = 0;
        GENERATED_PACKS.push(...packs);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        localStorage.setItem('sqlDetectiveGeneratedPacks', JSON.stringify(packs));
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—É
        loadLevelPacks();
        initializeGame();
        
        statusDiv.innerHTML = `
            <div style="background: #27ae60; color: white; padding: 12px; border-radius: 5px;">
                ‚úÖ –£—Å–ø–µ—à–Ω–æ! –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${packs.length} —Ç–µ–º —Å ${packs.reduce((sum, p) => sum + p.missions.length, 0)} —É—Ä–æ–∫–∞–º–∏
            </div>
        `;
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
        jsonInput.value = '';
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å –º–∏—Å—Å–∏—è–º–∏
        setTimeout(() => {
            switchTab('missions');
        }, 2000);
        
    } catch (error) {
        statusDiv.innerHTML = `
            <div style="background: #c0392b; color: white; padding: 12px; border-radius: 5px;">
                ‚ùå –û—à–∏–±–∫–∞: ${error.message}
            </div>
        `;
    }
}

// ============================================
// –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê
// ============================================

let database = {};
let missions = [];
let levelPacks = [];
let currentMission = 0;
let completedMissions = [];

document.addEventListener('DOMContentLoaded', () => {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–∏
    const savedGenerated = localStorage.getItem('sqlDetectiveGeneratedPacks');
    if (savedGenerated) {
        try {
            const packs = JSON.parse(savedGenerated);
            GENERATED_PACKS.length = 0;
            GENERATED_PACKS.push(...packs);
        } catch (e) {}
    }
    
    loadLevelPacks();
    loadProgress();
    initializeGame();
});

function toggleSidebar() {
    if (window.innerWidth < 1024) {
        document.getElementById('schemaSidebar').classList.toggle('collapsed');
    }
}

function loadLevelPacks() {
    const saved = localStorage.getItem('sqlDetectiveLevelPacks');
    if (saved) {
        try {
            const userPacks = JSON.parse(saved);
            levelPacks = [DEFAULT_LEVEL_PACK, ...GENERATED_PACKS, ...userPacks];
        } catch (e) {
            levelPacks = [DEFAULT_LEVEL_PACK, ...GENERATED_PACKS];
        }
    } else {
        levelPacks = [DEFAULT_LEVEL_PACK, ...GENERATED_PACKS];
    }
}

function saveLevelPacks() {
    const userPacks = levelPacks.filter(pack => 
        pack.packName !== DEFAULT_LEVEL_PACK.packName && 
        !GENERATED_PACKS.some(gp => gp.packName === pack.packName)
    );
    localStorage.setItem('sqlDetectiveLevelPacks', JSON.stringify(userPacks));
}

function initializeGame() {
    database = {};
    missions = [];
    
    levelPacks.forEach((pack) => {
        Object.assign(database, pack.database);
        
        pack.missions.forEach((mission) => {
            missions.push({
                ...mission,
                packName: pack.packName,
                checkFunction: createCheckFunction(mission.checkFunction)
            });
        });
    });
    
    renderLevelSelector();
    loadMission(currentMission);
    updateProgress();
}

function createCheckFunction(funcString) {
    try {
        return new Function('result', 'query', 'database', `return ${funcString};`);
    } catch (e) {
        console.error('Invalid checkFunction:', funcString);
        return () => false;
    }
}

function loadProgress() {
    const saved = localStorage.getItem('sqlDetectiveProgress');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            completedMissions = data.completedMissions || [];
            currentMission = data.currentMission || 0;
        } catch (e) {
            completedMissions = [];
            currentMission = 0;
        }
    }
}

function saveProgress() {
    localStorage.setItem('sqlDetectiveProgress', JSON.stringify({
        completedMissions, 
        currentMission, 
        savedAt: new Date().toISOString()
    }));
}

function resetProgress() {
    if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
        localStorage.removeItem('sqlDetectiveProgress');
        completedMissions = [];
        currentMission = 0;
        loadMission(0);
        updateProgress();
        showInsertIndicator('‚úì –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω');
    }
}

function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    
    document.getElementById(tabName).classList.add('active');
    event.target.classList.add('active');

    if (tabName === 'progress') updateProgressDetails();
}

function renderLevelSelector() {
    const container = document.getElementById('levelSelector');
    if (!container) return;
    
    container.innerHTML = missions.map((m, i) => `
        <button class="level-btn ${i === currentMission ? 'active' : ''} ${completedMissions.includes(i) ? 'completed' : ''}" 
                onclick="loadMission(${i})" title="${m.packName}">
            ${completedMissions.includes(i) ? '‚úì' : ''} #${i + 1}
        </button>
    `).join('');
}

function loadMission(index) {
    if (index < 0 || index >= missions.length) return;
    
    currentMission = index;
    const m = missions[index];
    
    document.getElementById('missionContent').innerHTML = `
        <div class="mission-brief">
            <div class="pack-badge">${m.packName}</div>
            <h2>${m.title}</h2>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${m.description}</p>
            <p><strong>–ó–∞–¥–∞–Ω–∏–µ:</strong> ${m.task}</p>
        </div>
    `;

    document.getElementById('sidebarSchema').innerHTML = Object.entries(m.schema).map(([table, cols]) => `
        <div class="schema-table" onclick="insertTableName('${table}')">
            <h4>üìã ${table}</h4>
            <ul>${cols.map(c => `<li onclick="event.stopPropagation(); insertFieldName('${c}')">${c}</li>`).join('')}</ul>
        </div>
    `).join('');
    
    document.getElementById('sqlInput').value = '';
    document.getElementById('resultContent').innerHTML = '<p style="color: #95a5a6;">–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å</p>';
    renderLevelSelector();
    saveProgress();
    
    if (window.innerWidth < 1024) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function insertTableName(t) { 
    insertKeyword(t + ' '); 
    showInsertIndicator(`"${t}"`); 
}

function insertFieldName(f) { 
    insertKeyword(f + ' '); 
    showInsertIndicator(`"${f}"`); 
}

function insertKeyword(kw) {
    const inp = document.getElementById('sqlInput');
    const s = inp.selectionStart, e = inp.selectionEnd;
    inp.value = inp.value.substring(0, s) + kw + inp.value.substring(e);
    inp.focus();
    inp.selectionStart = inp.selectionEnd = s + kw.length;
}

function showInsertIndicator(msg) {
    const ind = document.getElementById('insertIndicator');
    ind.textContent = msg || '‚úì';
    ind.classList.add('show');
    setTimeout(() => ind.classList.remove('show'), 1500);
}

function formatSQL() {
    const inp = document.getElementById('sqlInput');
    if (!inp.value.trim()) return;
    
    inp.value = inp.value.trim()
        .replace(/\s+/g, ' ')
        .replace(/\bSELECT\b/gi, '\nSELECT')
        .replace(/\bFROM\b/gi, '\nFROM')
        .replace(/\bWHERE\b/gi, '\nWHERE')
        .replace(/\bAND\b/gi, '\n  AND')
        .replace(/\bOR\b/gi, '\n  OR')
        .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
        .replace(/\bORDER BY\b/gi, '\nORDER BY')
        .replace(/\bHAVING\b/gi, '\nHAVING')
        .replace(/\bLIMIT\b/gi, '\nLIMIT')
        .trim();
    
    showInsertIndicator('‚ú® –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ');
}

function clearQuery() {
    document.getElementById('sqlInput').value = '';
    document.getElementById('resultContent').innerHTML = '<p style="color: #95a5a6;">–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å</p>';
}

function showHint() {
    const m = missions[currentMission];
    const hint = document.createElement('div');
    hint.className = 'hint';
    hint.innerHTML = `<strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong><br><code style="color: #2ecc71;">${m.hint}</code>`;
    
    const existing = document.querySelector('.hint');
    if (existing) existing.remove();
    
    document.getElementById('resultContent').insertAdjacentElement('afterend', hint);
}

function executeQuery() {
    const q = document.getElementById('sqlInput').value.trim();
    if (!q) {
        showError('–í–≤–µ–¥–∏—Ç–µ SQL –∑–∞–ø—Ä–æ—Å!');
        return;
    }

    try {
        const res = parseAndExecuteSQL(q);
        const m = missions[currentMission];

        if (m.checkFunction(res, q, database)) {
            showSuccess(res);
            if (!completedMissions.includes(currentMission)) {
                completedMissions.push(currentMission);
                saveProgress();
                updateProgress();
                renderLevelSelector();
            }
        } else {
            showResult(res, '–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—É—á–µ–Ω, –Ω–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë!');
        }
    } catch (err) {
        showError(err.message);
    }
}

// SQL Parser (—É–∫–æ—Ä–æ—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - –ø–æ–ª–Ω—ã–π –∫–æ–¥ —Ç–æ—Ç –∂–µ)
function parseAndExecuteSQL(q) {
    q = q.trim().replace(/\n/g, ' ').replace(/\s+/g, ' ').replace(/;$/, '');
    
    if (!q.toLowerCase().startsWith('select')) {
        throw new Error('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã');
    }
    
    const fromMatch = q.match(/\bfrom\s+([–∞-—è—ë–ê-–Ø–Å\w]+)/i);
    if (!fromMatch) throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –≤ FROM');
    
    const tableName = fromMatch[1];
    if (!database[tableName]) throw new Error(`–¢–∞–±–ª–∏—Ü–∞ "${tableName}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
    
    let data = [...database[tableName]];
    
    const whereMatch = q.match(/\bwhere\s+(.+?)(?:\s+group\s+by|\s+order\s+by|\s+having|\s+limit|$)/i);
    if (whereMatch) {
        const condition = whereMatch[1].trim();
        data = data.filter(row => evaluateCondition(row, condition));
    }
    
    const isDistinct = /\bselect\s+distinct\b/i.test(q);
    const colMatch = q.match(/\bselect\s+(distinct\s+)?(.*?)\s+from/i);
    let columns = colMatch ? colMatch[2].trim() : '*';
    const hasAgg = /count\s*\(|sum\s*\(|avg\s*\(|min\s*\(|max\s*\(/i.test(columns);
    
    const groupMatch = q.match(/\bgroup\s+by\s+(.+?)(?:\s+having|\s+order\s+by|\s+limit|$)/i);
    if (groupMatch || hasAgg) {
        return handleAggregation(data, columns, groupMatch, q);
    }
    
    if (columns !== '*') {
        data = data.map(row => {
            const newRow = {};
            columns.split(',').forEach(col => {
                const c = col.trim();
                if (c.includes(' as ')) {
                    const [expr, alias] = c.split(/\s+as\s+/i);
                    newRow[alias.trim()] = row[expr.trim()] || expr.trim();
                } else {
                    newRow[c] = row[c];
                }
            });
            return newRow;
        });
    }
    
    if (isDistinct) {
        const seen = new Set();
        data = data.filter(row => {
            const key = JSON.stringify(row);
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
        });
    }
    
    const orderMatch = q.match(/\border\s+by\s+(.+?)(?:\s+limit|$)/i);
    if (orderMatch) {
        const orderParts = orderMatch[1].split(',').map(p => p.trim());
        data.sort((a, b) => {
            for (let part of orderParts) {
                const desc = /\bdesc\b/i.test(part);
                const col = part.replace(/\s+(asc|desc)\s*$/i, '').trim();
                
                let aVal = a[col];
                let bVal = b[col];
                
                if (aVal === bVal) continue;
                if (aVal == null) return 1;
                if (bVal == null) return -1;
                
                if (typeof aVal === 'string') {
                    return desc ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
                }
                
                return desc ? bVal - aVal : aVal - bVal;
            }
            return 0;
        });
    }
    
    const limitMatch = q.match(/\blimit\s+(\d+)(?:\s+offset\s+(\d+))?/i);
    if (limitMatch) {
        const limit = parseInt(limitMatch[1]);
        const offset = limitMatch[2] ? parseInt(limitMatch[2]) : 0;
        data = data.slice(offset, offset + limit);
    }
    
    return data;
}

function evaluateCondition(row, condition) {
    if (condition.includes(' like ')) {
        const parts = condition.split(/\s+like\s+/i);
        const field = parts[0].trim();
        const pattern = parts[1].trim().replace(/['"]/g, '');
        const regex = new RegExp('^' + pattern.replace(/%/g, '.*').replace(/_/g, '.') + '$', 'i');
        return regex.test(String(row[field] || ''));
    }
    
    if (condition.includes(' in ')) {
        const parts = condition.split(/\s+in\s+/i);
        const field = parts[0].trim();
        const valuesStr = parts[1].trim().replace(/[()]/g, '');
        const values = valuesStr.split(',').map(v => v.trim().replace(/['"]/g, ''));
        return values.includes(String(row[field]));
    }
    
    if (condition.includes(' not in ')) {
        const parts = condition.split(/\s+not\s+in\s+/i);
        const field = parts[0].trim();
        const valuesStr = parts[1].trim().replace(/[()]/g, '');
        const values = valuesStr.split(',').map(v => v.trim().replace(/['"]/g, ''));
        return !values.includes(String(row[field]));
    }
    
    if (condition.includes(' between ')) {
        const parts = condition.split(/\s+between\s+/i);
        const field = parts[0].trim();
        const range = parts[1].split(/\s+and\s+/i);
        const min = range[0].trim().replace(/['"]/g, '');
        const max = range[1].trim().replace(/['"]/g, '');
        const val = row[field];
        return val >= min && val <= max;
    }
    
    const operators = ['!=', '>=', '<=', '=', '>', '<'];
    for (let op of operators) {
        if (condition.includes(op)) {
            const [field, value] = condition.split(op).map(x => x.trim());
            const val = value.replace(/['"]/g, '');
            const rowVal = row[field];
            
            switch(op) {
                case '=': return String(rowVal) == val;
                case '!=': return String(rowVal) != val;
                case '>': return Number(rowVal) > Number(val);
                case '<': return Number(rowVal) < Number(val);
                case '>=': return Number(rowVal) >= Number(val);
                case '<=': return Number(rowVal) <= Number(val);
            }
        }
    }
    
    return true;
}

function handleAggregation(data, columns, groupMatch, fullQuery) {
    if (!groupMatch) {
        const result = {};
        const funcs = columns.match(/(count|sum|avg|min|max)\s*\([^)]*\)/gi) || [];
        
        funcs.forEach(func => {
            const alias = columns.match(new RegExp(func.replace(/[()]/g, '\\$&') + '\\s+as\\s+(\\w+)', 'i'));
            const name = alias ? alias[1] : func;
            
            if (/count\s*\(\s*\*\s*\)/i.test(func)) {
                result[name] = data.length;
            } else {
                const field = func.match(/\(([^)]+)\)/)[1].trim();
                const values = data.map(r => Number(r[field])).filter(v => !isNaN(v));
                
                if (/sum/i.test(func)) result[name] = values.reduce((a, b) => a + b, 0);
                else if (/avg/i.test(func)) result[name] = values.reduce((a, b) => a + b, 0) / values.length;
                else if (/min/i.test(func)) result[name] = Math.min(...values);
                else if (/max/i.test(func)) result[name] = Math.max(...values);
            }
        });
        
        return [result];
    }
    
    const groupFields = groupMatch[1].split(',').map(f => f.trim());
    const groups = {};
    
    data.forEach(row => {
        const key = groupFields.map(f => row[f]).join('|');
        if (!groups[key]) groups[key] = [];
        groups[key].push(row);
    });
    
    const results = Object.entries(groups).map(([key, rows]) => {
        const result = {};
        const keyParts = key.split('|');
        groupFields.forEach((f, i) => result[f] = keyParts[i]);
        
        const funcs = columns.match(/(count|sum|avg|min|max)\s*\([^)]*\)/gi) || [];
        funcs.forEach(func => {
            const alias = columns.match(new RegExp(func.replace(/[()]/g, '\\$&') + '\\s+as\\s+(\\w+)', 'i'));
            const name = alias ? alias[1] : func.toLowerCase().replace(/[()]/g, '_');
            
            if (/count\s*\(\s*\*\s*\)/i.test(func)) {
                result[name] = rows.length;
            } else {
                const field = func.match(/\(([^)]+)\)/)[1].trim();
                const values = rows.map(r => Number(r[field])).filter(v => !isNaN(v));
                
                if (/sum/i.test(func)) result[name] = values.reduce((a, b) => a + b, 0);
                else if (/avg/i.test(func)) result[name] = values.reduce((a, b) => a + b, 0) / values.length;
                else if (/min/i.test(func)) result[name] = Math.min(...values);
                else if (/max/i.test(func)) result[name] = Math.max(...values);
                else if (/count/i.test(func)) result[name] = values.length;
            }
        });
        
        return result;
    });
    
    const havingMatch = fullQuery.match(/\bhaving\s+(.+?)(?:\s+order\s+by|\s+limit|$)/i);
    if (havingMatch) {
        const havingCond = havingMatch[1].trim();
        return results.filter(row => evaluateCondition(row, havingCond));
    }
    
    return results;
}

function showSuccess(res) {
    const m = missions[currentMission];
    const nextBtn = currentMission < missions.length - 1 ? 
        `<button class="btn btn-primary next-mission-btn" onclick="loadMission(${currentMission + 1})">
            –°–ª–µ–¥—É—é—â–µ–µ –¥–µ–ª–æ ‚Üí
        </button>` : '';
    
    document.getElementById('resultContent').innerHTML = `
        <div class="success">
            <h3>‚úÖ –î–µ–ª–æ —Ä–∞—Å–∫—Ä—ã—Ç–æ!</h3>
            <p>–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ.</p>
            ${nextBtn}
        </div>
        ${renderTable(res)}
    `;
}

function showResult(res, msg) {
    document.getElementById('resultContent').innerHTML = `
        <p style="color: #f39c12; margin-bottom: 10px;">${msg}</p>
        ${renderTable(res)}
    `;
}

function showError(msg) {
    document.getElementById('resultContent').innerHTML = `
        <div class="error">
            <strong>‚ùå –û—à–∏–±–∫–∞:</strong> ${msg}
        </div>
    `;
}

function renderTable(data) {
    if (!data || data.length === 0) {
        return '<p style="color: #95a5a6;">–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç</p>';
    }
    
    const keys = Object.keys(data[0]);
    return `
        <div class="result-table">
            <table>
                <thead>
                    <tr>${keys.map(k => `<th>${k}</th>`).join('')}</tr>
                </thead>
                <tbody>
                    ${data.map(row => `<tr>${keys.map(k => `<td>${row[k] ?? 'NULL'}</td>`).join('')}</tr>`).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function updateProgress() {
    const total = missions.length;
    const completed = completedMissions.length;
    const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    const bar = document.getElementById('progressBar');
    if (bar) {
        bar.style.width = percent + '%';
        bar.textContent = percent + '%';
    }
}

function updateProgressDetails() {
    const total = missions.length;
    const completed = completedMissions.length;
    const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
    
    const packStats = {};
    missions.forEach((m, i) => {
        if (!packStats[m.packName]) {
            packStats[m.packName] = { total: 0, completed: 0 };
        }
        packStats[m.packName].total++;
        if (completedMissions.includes(i)) {
            packStats[m.packName].completed++;
        }
    });
    
    document.getElementById('progressDetails').innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <h4>–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</h4>
                <div class="value">${total}</div>
            </div>
            <div class="stat-card">
                <h4>–ü—Ä–æ–π–¥–µ–Ω–æ</h4>
                <div class="value">${completed}</div>
            </div>
            <div class="stat-card">
                <h4>–û—Å—Ç–∞–ª–æ—Å—å</h4>
                <div class="value">${total - completed}</div>
            </div>
            <div class="stat-card">
                <h4>–ü—Ä–æ–≥—Ä–µ—Å—Å</h4>
                <div class="value">${percent}%</div>
            </div>
        </div>
        
        <div class="settings-section">
            <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º</h3>
            ${Object.entries(packStats).map(([name, stats]) => `
                <div class="info-box">
                    <h4 style="color: #f39c12; margin-bottom: 5px;">${name}</h4>
                    <p>–ü—Ä–æ–π–¥–µ–Ω–æ: ${stats.completed} –∏–∑ ${stats.total} (${Math.round((stats.completed/stats.total)*100)}%)</p>
                    <div class="progress-bar" style="height: 10px; margin-top: 5px;">
                        <div class="progress-fill" style="width: ${(stats.completed/stats.total)*100}%"></div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function importPacks() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            if (data.packs && Array.isArray(data.packs)) {
                let imported = 0;
                data.packs.forEach(pack => {
                    if (!levelPacks.some(p => p.packName === pack.packName)) {
                        levelPacks.push(pack);
                        imported++;
                    }
                });
                
                if (imported > 0) {
                    saveLevelPacks();
                    initializeGame();
                    showInsertIndicator(`‚úì –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${imported} —Ç–µ–º`);
                    alert(`–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${imported} —Ç–µ–º!`);
                } else {
                    alert('–í—Å–µ —Ç–µ–º—ã –∏–∑ —Ñ–∞–π–ª–∞ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                }
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –û–∂–∏–¥–∞–µ—Ç—Å—è JSON —Å –º–∞—Å—Å–∏–≤–æ–º packs.');
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: ' + error.message);
        }
    };
    input.click();
}

function exportAllPacks() {
    const exportPacks = levelPacks.filter(pack => 
        pack.packName !== DEFAULT_LEVEL_PACK.packName
    );
    
    const data = {
        exportDate: new Date().toISOString(),
        version: "1.0",
        packs: exportPacks,
        totalMissions: exportPacks.reduce((sum, pack) => sum + pack.missions.length, 0)
    };
    
    downloadJSON(data, `sql-detective-packs-${getDateString()}.json`);
    showInsertIndicator('‚úì –¢–µ–º—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
}

function exportProgress() {
    const data = {
        exportDate: new Date().toISOString(),
        completedMissions: completedMissions,
        currentMission: currentMission,
        totalMissions: missions.length,
        stats: {
            completionRate: missions.length > 0 ? Math.round((completedMissions.length / missions.length) * 100) : 0
        }
    };
    
    downloadJSON(data, `sql-detective-progress-${getDateString()}.json`);
    showInsertIndicator('‚úì –ü—Ä–æ–≥—Ä–µ—Å—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω');
}

function downloadJSON(data, filename) {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

function getDateString() {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
}
    </script>
</body>
</html>
